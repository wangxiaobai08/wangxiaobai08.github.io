

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ling">
  <meta name="keywords" content="">
  
    <meta name="description" content="早年在知乎发的文章，现转载到博客上  网络层的作用？网络层的作用从表面上看极为简单，即将分组从一台发送主机移动到一台接收主机 为此，需要两种重要的网络层功能: 转发：当一个分组到达路由器的一条输入链路时，路由器必须将该分组移动到适 当的输出链路 例如，来自主机 Hl 到路由器 Rl 的一个分组，必须向在 H2 路径 上的下一台路由器转发。 路由选择 当分组从发送方流向接收方时，网络层必须决定这些">
<meta property="og:type" content="article">
<meta property="og:title" content="网络层">
<meta property="og:url" content="http://example.com/2023/01/30/%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="The Peak Tower">
<meta property="og:description" content="早年在知乎发的文章，现转载到博客上  网络层的作用？网络层的作用从表面上看极为简单，即将分组从一台发送主机移动到一台接收主机 为此，需要两种重要的网络层功能: 转发：当一个分组到达路由器的一条输入链路时，路由器必须将该分组移动到适 当的输出链路 例如，来自主机 Hl 到路由器 Rl 的一个分组，必须向在 H2 路径 上的下一台路由器转发。 路由选择 当分组从发送方流向接收方时，网络层必须决定这些">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic1.zhimg.com/v2-8f832cedebafa39ac1198a6b62ca85b2_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-b3fdfa34bf1e361f458e1cdecf5bfee3_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-ee98958735d93da93e5761ee7342614f_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-a640ac196dc7213ec9df92ce71685173_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-bcd8da781302b3623e9649cfbf5b2ce6_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-e44d00a81ccb160b9052737929c13b85_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-d3c6c4f7c280be324b8e4fbe0f830bc1_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-c910e8824efb3f6ab08b1a751d3c7159_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-94f51d069fb6851230d6aa58653a7ed7_1440w.jpg">
<meta property="og:image" content="https://pica.zhimg.com/v2-896bde3f226a3b26e686c98d12b258ee_1440w.jpg">
<meta property="og:image" content="https://pica.zhimg.com/v2-12cc1c15e971ab9859917a3997b4eb50_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-25839a5f59c066e6fdccb158604ab810_1440w.jpg">
<meta property="og:image" content="https://picx.zhimg.com/v2-282d2b29bb8e2b9cbf6adc4e2af92393_1440w.jpg">
<meta property="og:image" content="https://picx.zhimg.com/v2-89da487f5b5204ae0ce34157b046c47f_1440w.jpg">
<meta property="og:image" content="https://pica.zhimg.com/v2-1a6e4c5a65aa3aec676c3c83e1eb9914_1440w.jpg">
<meta property="og:image" content="https://picx.zhimg.com/v2-6c376ed9df6cd0338b30cf78ae391d57_1440w.jpg">
<meta property="og:image" content="https://picx.zhimg.com/v2-8d3b7cf2cd86ddb01bef5d752611500b_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-36d7c45ca42aa6c6ddb89a539794312b_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-8af5f59d24aac8052f63f15e77abc0f7_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-e01220b4542d0955cc8dfe299575e2ba_1440w.jpg">
<meta property="og:image" content="https://pica.zhimg.com/v2-081d688950d282171eb0fea7c2fd1050_1440w.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/v2-c7e39eff0fdf0e6458cb632f9a3ad1b7_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-2e2a022b814d598c41ed8576684a20fd_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-9ccfbdc7625b117d42970c2156a89fb2_1440w.jpg">
<meta property="og:image" content="https://pica.zhimg.com/v2-668cb57e318656d7c90cefcef8f8e726_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/v2-887eb41091f3ca32b729c846fca87727_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/v2-f9d96b14ed3e22f32b9363314f66f774_1440w.jpg">
<meta property="og:image" content="https://pic3.zhimg.com/v2-da1fb8f9b33337f01f143cb488eddd32_1440w.jpg">
<meta property="article:published_time" content="2023-01-30T08:51:14.000Z">
<meta property="article:modified_time" content="2025-03-09T09:14:50.743Z">
<meta property="article:author" content="Ling">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://pic1.zhimg.com/v2-8f832cedebafa39ac1198a6b62ca85b2_1440w.jpg">
  
  
  
  <title>网络层 - The Peak Tower</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="网络层"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-01-30 16:51" pubdate>
          2023年1月30日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          84 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">网络层</h1>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>早年在知乎发的文章，现转载到博客上</p>
</blockquote>
<h2 id="网络层的作用？"><a href="#网络层的作用？" class="headerlink" title="网络层的作用？"></a>网络层的作用？</h2><p>网络层的作用从表面上看极为简单，即将分组从一台发送主机移动到一台接收主机</p>
<p>为此，需要两种重要的网络层功能:</p>
<p><strong>转发：</strong>当一个分组到达路由器的一条输入链路时，路由器必须将该分组移动到适</p>
<p>当的输出链路 例如，来自主机 Hl 到路由器 Rl 的一个分组，必须向在 H2 路径</p>
<p>上的下一台路由器转发。</p>
<p><strong>路由选择</strong> 当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路</p>
<p>由或路径，计算这些路径的算法被称为路由选择算法</p>
<h2 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a>网际协议IP</h2><p><img src="https://pic1.zhimg.com/v2-8f832cedebafa39ac1198a6b62ca85b2_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>IP是TCP&#x2F; IP协议族中最为核心的协议。其提供不可靠、无连接的数据报传送服务。</p>
<p><strong>不可靠</strong>的意思是它不能保证 I P数据报能成功地到达目的地。IP仅提供最好的传输服务。如果发生某种错误时，如某个路由器暂时用完了缓冲区，IP有一个简单的错误处理算法：丢弃该数据报，然后发送 ICMP消息报给信源端。任何要求的可靠性必须由上层来提供（如T C P）。</p>
<p><strong>无连接</strong>的意思是 IP并不维护任何关于后续数据报的状态信息。每个数据报的处理是相互独立的。这也说明，IP数据报可以不按发送顺序接收。如果一信源向相同的信宿发送两个连续的数据报（先是 A，然后是B），每个数据报都是独立地进行路由选择，可能选择不同的路线，因此 B可能在A到达之前先到达。</p>
<h3 id="IP首部"><a href="#IP首部" class="headerlink" title="IP首部"></a>IP首部</h3><p><img src="https://pic4.zhimg.com/v2-b3fdfa34bf1e361f458e1cdecf5bfee3_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol>
<li>首部长度指的是首部占 32 bit字的数目，包括任何选项。由于它是一个 4比特字段，因此首部最长为60个字节。</li>
<li>服务类型字段包括一个3 bit的优先权子字段（现在已被忽略），4 bit的TOS子字段和1 bit未用位但必须置0。4 bit的TOS分别代表：最小时延、最大吞吐量、最高可靠性和最小费用。</li>
<li>总长度字段是指整个IP数据报的长度，以字节为单位。利用首部长度字段和总长度字段，就可以知道 I P数据报中数据内容的起始位置和长度。由于该字段长 1 6比特，所以 I P数据报最长可达 6 5 5 3 5字节，当数据报被分片时，该字段的值也随着变化。</li>
<li>标识字段唯一地标识主机发送的每一份数据报。</li>
<li>首部检验和字段是根据I P首部计算的检验和码。它不对首部后面的数据进行计算IC MP、IGMP、UDP和TCP在它们各自的首部中均含有同时覆盖首部和数据检验和码。</li>
</ol>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><h3 id="IP地址表示-分类"><a href="#IP地址表示-分类" class="headerlink" title="IP地址表示+分类"></a>IP地址表示+分类</h3><p><img src="https://pic2.zhimg.com/v2-ee98958735d93da93e5761ee7342614f_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://pic4.zhimg.com/v2-a640ac196dc7213ec9df92ce71685173_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://pic1.zhimg.com/v2-bcd8da781302b3623e9649cfbf5b2ce6_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="IP子网划分"><a href="#IP子网划分" class="headerlink" title="IP子网划分"></a>IP子网划分</h3><p>子网划分这项技术用来把一个单一的IP网络地址划分成多个更小的子网(subnet)。 这种技术可使一个较大的分类IP地址能够被进一步划分为几个子网。通常是把IP地址中主机标识部分划出一定的位数用作本网的各个子网，剩余的主机标识作为相应子网的主机标识部分。</p>
<p>（地址掩码是一个32位的二进制数，用于指示一个IP地址中哪些位用于网络标识，哪些位用于主机标识。地址掩码与IP地址一起使用，确定IP地址的网络部分和主机部分。）</p>
<p><img src="https://pic2.zhimg.com/v2-e44d00a81ccb160b9052737929c13b85_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="无分类编址CIDR"><a href="#无分类编址CIDR" class="headerlink" title="无分类编址CIDR"></a>无分类编址CIDR</h3><p>在传统的地址分配方法中，如果一个组织只需要500个IP地址，但是它被分配了一个B类地址，这意味着该组织将获得超过65000个IP地址的地址块，其中绝大多数都无法使用。这会导致大量的IP地址浪费。为了解决IPv4地址空间不足的问题而提出CIDR。</p>
<p><strong>通过将IP地址划分为更小的子网来解决这个问题</strong>。CIDR中，一个IP地址由网络前缀和主机标识符两部分组成，其中网络前缀用于标识主机所在的网络，主机标识符用于标识该主机在该网络中的位置。CIDR中，网络前缀的长度可以是任意的，这使得网络管理员可以更灵活地分配IP地址，从而减少了IP地址的浪费。</p>
<p><img src="https://pic4.zhimg.com/v2-d3c6c4f7c280be324b8e4fbe0f830bc1_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="地址解析协议ARP"><a href="#地址解析协议ARP" class="headerlink" title="地址解析协议ARP"></a>地址解析协议ARP</h2><p><strong>数据链路如以太网或令牌环网都有自己的寻址机制</strong>（常常为 48 bit地址），这是使用数据链路的任何网络层都必须遵从的。一个网络如以太网可以同时被不同的网络层使用。例如，一组使用T P&#x2F;IP协议的主机和另一组使用某种P C网络软件的主机可以共享相同的电缆。当一台主机把以太网数据帧发送到位于同一局域网上的另一台主机时，是根据 48 bit的以太网地址来确定目的接口的。设备驱动程序从不检查 I P数据报中的目的I P地址。地址解析为这两种不同的地址形式提供映射：32 bit的IP地址和数据链路层使用的任何类型的地址。ARP为IP地址到对应的硬件地址之间提供动态映射。</p>
<h3 id="ARP的分组格式"><a href="#ARP的分组格式" class="headerlink" title="ARP的分组格式"></a>ARP的分组格式</h3><p><img src="https://pic2.zhimg.com/v2-c910e8824efb3f6ab08b1a751d3c7159_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="ARP工作原理"><a href="#ARP工作原理" class="headerlink" title="ARP工作原理"></a>ARP工作原理</h3><p><strong>ARP请求：</strong></p>
<p>当主机A知道目标主机的IP地址，但不知道其对应的MAC地址时，它会在局域网内广播一个ARP请求包，请求其他主机告知该IP地址对应的MAC地址。</p>
<p><strong>ARP应答：</strong></p>
<p>目标主机收到ARP请求后，如果发现自己的IP地址与请求中的IP地址相符，就会向源主机发送一个ARP应答包，其中包含自己的MAC地址。</p>
<p><strong>ARP缓存：</strong></p>
<p>每个主机在接收到ARP应答后，会将对应的IP地址和MAC地址进行缓存，以便将来直接进行通信而不需要再次发送ARP请求。</p>
<p><strong>ARP欺骗：</strong></p>
<p>由于ARP协议的工作原理，存在一定的安全漏洞，即ARP欺骗，攻击者可以发送虚假的ARP响应，欺骗其他主机将其数据发送到攻击者的主机上。</p>
<h3 id="一个例子："><a href="#一个例子：" class="headerlink" title="一个例子："></a>一个例子：</h3><p><img src="https://pic4.zhimg.com/v2-94f51d069fb6851230d6aa58653a7ed7_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h2><h3 id="路由器演变历史"><a href="#路由器演变历史" class="headerlink" title="路由器演变历史"></a>路由器演变历史</h3><p><strong>早期网络：</strong></p>
<p>在互联网发展的初期，网络通信主要基于主机到主机的连接方式。每个主机都需要了解整个网络的拓扑结构，并且需要知道如何直接与其他主机进行通信。</p>
<p><strong>分组交换网络：</strong></p>
<p>随着网络规模的增长，主机到主机的连接方式变得不可行且低效。为了提高网络性能，分组交换网络应运而生。这种网络将数据分割成小的数据包（分组），每个数据包独立传输，并通过网络中的节点进行转发。</p>
<p><strong>网络节点：</strong></p>
<p>为了实现分组交换，网络中的节点（也称为数据包交换机）开始出现。这些节点负责接收数据包，并根据目标地址来决定将数据包转发到哪个接口。</p>
<p><strong>路由表：</strong></p>
<p>随着网络规模的进一步增长，网络中的节点需要更复杂的路由决策。为此，引入了路由表的概念。路由表包含了网络中不同目标地址所对应的下一跳信息，用于指导数据包的转发。</p>
<p><strong>路由器的出现：</strong></p>
<p>随着网络规模的不断扩大，为了更高效地管理网络流量和实现灵活的路由决策，专用的路由器设备开始出现。路由器是一种硬件设备，具有处理数据包转发和路由协议等功能。</p>
<p><strong>路由协议：</strong></p>
<p>路由器通过使用各种路由协议（如RIP、OSPF、BGP等）来学习和交换路由信息。这些协议使得路由器能够动态地更新路由表，并根据网络状况进行最优的路由选择。</p>
<p><strong>随着互联网的快速发展，路由器的功能和性能也得到了不断的提升。现代路由器不仅用于连接不同的局域网和广域网，还具备防火墙、VPN、负载均衡等功能，成为网络中重要的基础设施之一。</strong></p>
<p><img src="https://pica.zhimg.com/v2-896bde3f226a3b26e686c98d12b258ee_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="路由器的工作原理"><a href="#路由器的工作原理" class="headerlink" title="路由器的工作原理"></a>路由器的工作原理</h3><p><strong>接收数据包：</strong></p>
<p>路由器通过其接口（例如以太网、无线）接收到来自源主机的数据包。</p>
<p><strong>解析目标地址：</strong></p>
<p>路由器检查数据包的目标IP地址，并在其路由表中查找匹配项。路由表中的条目通常包括目标网络的IP地址范围和下一跳的信息。</p>
<p><strong>查找最佳路径：</strong></p>
<p>路由器根据路由表中的信息确定最佳的转发路径。这可能涉及到多个路由器之间的转发。</p>
<p><strong>转发数据包：</strong></p>
<p>路由器将数据包发送到下一跳或目标网络。它会通过适当的接口将数据包传输到相应的网络。</p>
<p><strong>更新路由表：</strong></p>
<p>路由器可以使用动态路由协议（如RIP、OSPF、BGP等）学习和更新路由表。这些协议允许路由器与其他路由器交换路由信息，以便实时地调整路由选择。</p>
<p><strong>网络地址转换（NAT）（可选）：</strong></p>
<p>在某些情况下，路由器可能还执行网络地址转换（NAT）的功能。NAT将私有IP地址转换为公共IP地址，以便在互联网上进行通信。</p>
<p><strong>安全功能（可选）：</strong></p>
<p>现代路由器通常还具备防火墙、入侵检测和虚拟专用网络（VPN）等安全功能，以保护网络免受恶意攻击和非法访问。</p>
<p><img src="https://pica.zhimg.com/v2-12cc1c15e971ab9859917a3997b4eb50_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="虚拟专用网VPN"><a href="#虚拟专用网VPN" class="headerlink" title="虚拟专用网VPN"></a>虚拟专用网VPN</h3><p>虚拟专用网络（VPN）是一种通过公共网络（如互联网）建立安全的连接的技术。</p>
<p>VPN 的主要目的是提供一个加密和匿名的网络连接，使用户可以在不安全的公共网络上进行安全的通信。它通过在用户设备和目标服务器之间创建一个加密的隧道来保护数据的传输。这使得用户可以在公共网络上发送和接收数据，同时保持数据的机密性和完整性。</p>
<p><strong>使用 VPN 可以带来以下好处：</strong></p>
<p>数据加密：VPN 使用加密技术对数据进行加密，从而保护用户的隐私和敏感信息，防止被窃听或篡改。</p>
<p>匿名性：VPN 可以隐藏用户的真实 IP 地址，并代表用户向目标服务器发送请求，增强了用户的匿名性和隐私保护。</p>
<p><strong>绕过地理限制：</strong>通过连接到不同地区的 VPN 服务器，用户可以绕过地理限制，访问被限制在特定地区的内容和服务。</p>
<p>公共Wi-Fi 安全：当使用公共 Wi-Fi 网络时，VPN 可以提供额外的安全性，防止黑客和恶意用户窃取用户的个人信息。</p>
<h3 id="VPN工作原理"><a href="#VPN工作原理" class="headerlink" title="VPN工作原理"></a>VPN工作原理</h3><ol>
<li><strong>建立连接：</strong>用户打开 VPN 客户端，并选择连接到 VPN 服务器。客户端和服务器之间建立一个安全的连接。</li>
<li><strong>数据加密：</strong>在建立连接后，VPN 客户端和服务器之间的通信会使用加密算法对数据进行加密。这样，即使有人截获了数据包，也无法解读其内容。</li>
<li><strong>数据封装：</strong>当用户发送数据时，VPN 客户端会将数据包装在一个新的数据包中，添加了VPN的头部信息。这个过程称为“封装”（encapsulation）。</li>
<li><strong>隧道传输：</strong>经过封装后的数据被发送到 VPN 服务器，通过公共网络进行传输。由于数据已被加密和封装，所以即使在传输过程中被窃听，也无法获取其原始内容。</li>
<li><strong>数据解封装：</strong>一旦数据抵达 VPN 服务器，服务器会解开封装，还原原始数据。</li>
<li>目标访问：解封装后的数据会被发送到目标服务器，目标服务器会向其响应。</li>
<li>响应封装：目标服务器的响应数据会被封装，加上VPN的头部信息。</li>
<li><strong>返回给客户端：</strong>封装后的响应数据通过加密隧道返回到 VPN 客户端，然后在客户端进行解封装和解密。</li>
</ol>
<h3 id="网络地址转换（NAT）"><a href="#网络地址转换（NAT）" class="headerlink" title="网络地址转换（NAT）"></a>网络地址转换（NAT）</h3><p>网络地址转换（NAT）是一种将私有 IP 地址转换为公共 IP 地址的技术。NAT 技术主要用于在局域网和互联网之间进行通信时，使得局域网中的多个主机可以使用同一个公共 IP 地址访问互联网。</p>
<p>NAT 的基本原理是将内部网络的私有 IP 地址映射到公共 IP 地址，这样就可以在不改变内部网络结构的情况下实现网络连接。例如，当内部网络的主机向外部网络发送请求时，路由器会将其源 IP 地址修改为公共 IP 地址，以便从外部网络响应请求。</p>
<p><img src="https://pic1.zhimg.com/v2-25839a5f59c066e6fdccb158604ab810_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h3><p>路由表（Routing Table）是路由器或计算机操作系统中存储的一种数据结构，它用于决定数据包从源地址到目的地址的传输路径。路由表中包含了各种网络目的地及与之相关联的下一跳信息，以帮助设备进行数据包的转发和路由选择。路由表中的每一项都包含下面这些信息：</p>
<p>• 目的I P地址。它既可以是一个完整的主机地址，也可以是一个网络地址，由该表目中的标志字段来指定（如下所述）。主机地址有一个非0的主机号（见图1 - 5），以指定某一特定的主机，而网络地址中的主机号为0，以指定网络中的所有主机（如以太网，令牌环网）。</p>
<p>• 下一站（或下一跳）路由器（ next-hop router）的I P地址，或者有直接连接的网络 I P地址。下一站路由器是指一个在直接相连网络上的路由器，通过它可以转发数据报。下一站路由器不是最终的目的，但是它可以把传送给它的数据报转发到最终目的。</p>
<p>• 标志。其中一个标志指明目的 I P地址是网络地址还是主机地址，另一个标志指明下一站路由器是否为真正的下一站路由器，还是一个直接相连的接口（我们将在 9 . 2节中详细介绍这些标志）。</p>
<p>• 为数据报的传输指定一个网络接口。</p>
<p><img src="https://picx.zhimg.com/v2-282d2b29bb8e2b9cbf6adc4e2af92393_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="IP选路"><a href="#IP选路" class="headerlink" title="IP选路"></a>IP选路</h2><h3 id="IP路由选择"><a href="#IP路由选择" class="headerlink" title="IP路由选择"></a>IP路由选择</h3><p>IP路由选择是逐跳地进行的。IP并不知道到达任何目的的完整路径（当然，除了那些与主机直接相连的目的）。所有的IP路由选择只为数据报传输提供下一站路由器的 I P地址。它假定下一站路由器比发送数据报的主机更接近目的，而且下一站路由器与该主机是直接相连的。</p>
<p>IP路由选择主要完成以下这些功能：</p>
<ol>
<li>搜索路由表，寻找能与目的 I P地址完全匹配的表目（网络号和主机号都要匹配）。如果<br>找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口（取决于标<br>志字段的值）。</li>
<li>搜索路由表，寻找能与目的网络号相匹配的表目。如果找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口（取决于标志字段的值）。目的网络上的所有主机都可以通过这个表目来处置。例如，一个以太网上的所有主机都是通过这种表目进行寻径的。这种搜索网络的匹配方法必须考虑可能的子网掩码。关于这一点我们在下一节中进行讨论。</li>
<li>搜索路由表，寻找标为“默认”的表目。如果找到，则把报文发送给该表目</li>
</ol>
<p>指定的下一站路由器。</p>
<p>如果上面这些步骤都没有成功，那么该数据报就不能被传送。如果不能传送的数据报来自本机，那么一般会向生成数据报的应用程序返回一个“主机不可达”或“网络不可达”的错误。（网络控制报文协议ICMP）<strong>一个例子：</strong></p>
<p>主机 b s d i有一个I P数据报要发送给主机 s u n。双方都在同一个以太网上。</p>
<p><img src="https://picx.zhimg.com/v2-89da487f5b5204ae0ce34157b046c47f_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>主机 b s d i有一个I P数据报要发送给主机 s u n。双方不在同一个以太网上。</p>
<p><img src="https://pica.zhimg.com/v2-1a6e4c5a65aa3aec676c3c83e1eb9914_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>对于这个例子需要指出一些关键点：</p>
<ol>
<li>该例子中的所有主机和路由器都使用了默认路由。事实上，大多数主机和一些路由器<br>可以用默认路由来处理任何目的，除非它在本地局域网上。</li>
<li>数据报中的目的I P地址始终不发生任何变化，只有使用源路由选项时，目的I P地址才有可能被修改，但这种情况很少出现）。所有的路由选择决策都是基于这个目的I P地址。</li>
<li>每个链路层可能具有不同的数据帧首部，而且链路层的目的地址（如果有的话）始终指的是下一站的链路层地址。在例子中，两个以太网封装了含有下一站以太网地址的链路层首部，但是S L I P链路没有这样做。以太网地址一般通过ARP获得。</li>
</ol>
<h3 id="IP动态选路协议"><a href="#IP动态选路协议" class="headerlink" title="IP动态选路协议"></a>IP动态选路协议</h3><p>在网络很小，且与其他网络只有单个连接点且没有多余路由时（若主路由失败，可以使用备用路由），采用静态路由选择是可行的。但如果上述三种情况不能全部满足，通常使用<strong>动态选路</strong>。</p>
<p>当相邻路由器之间进行通信，以告知对方每个路由器当前所连接的网络，这时就出现了动态选路。路由器之间必须采用选路协议进行通信，。路由器上有一个进程称为路由守护程序，它运行选路协议,并与其相邻的一些路由器进行通信。路由守护程序根据它从相邻路由器接收到的信息，更新内核中的路由表。动态选路并不改变选路机制内核搜索路由表，查找主机路由、网络路由以及默认路由的方式并没有改变。仅仅是放置到路由表中的信息改变了—当路由随时间变化时，路由是由路</p>
<p>由守护程序动态地增加或删除。Interne是以一组自治系统的方式组织的，每个自治系统通常由单个实体管理。常常将一个公司或大学校园定义为一个自治系统。 N S F N E T的In t e r n e t骨干网形成一个自治系统，这是因为骨干网中的所有路由器都在单个的管理控制之下。<strong>每个自治系统可以选择该自治系统中各个路由器之间的选路协议。这种协议我们称之为内部网关协议IGP或域内选路协议.</strong></p>
<p><strong>外部网关协议EGP或域内选路协议的分隔选路协议用于不同自治系统之间的路由器。</strong></p>
<h3 id="内部网关协议RIP"><a href="#内部网关协议RIP" class="headerlink" title="内部网关协议RIP"></a>内部网关协议RIP</h3><p>RIP是一种基于距离向量的内部网关协议（IGP），用于在小型网络中动态交换路由信息。RIP是一种简单、易于实现的路由协议，常用于较小规模的网络环境。</p>
<h3 id="RIP报文格式"><a href="#RIP报文格式" class="headerlink" title="RIP报文格式"></a>RIP报文格式</h3><p><img src="https://picx.zhimg.com/v2-6c376ed9df6cd0338b30cf78ae391d57_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="RIP协议的一些特点："><a href="#RIP协议的一些特点：" class="headerlink" title="RIP协议的一些特点："></a>RIP协议的一些特点：</h3><p><strong>距离向量：</strong>RIP使用距离向量算法来计算到达目的网络的最佳路径。每个路由器根据收到的邻居路由器的距离信息，更新自己的路由表。</p>
<p><strong>距离度量：</strong>RIP使用跳数作为距离度量，即将到达目的网络所经过的路由器数量作为衡量路径优劣的标准。默认情况下，RIP将跳数限制在15跳以内，超过这个跳数则认为到达目的地不可达。</p>
<p><strong>广播更新：</strong>RIP使用广播方式周期性地向网络中的其他路由器发送路由更新信息，以交换路由信息。这样，所有路由器都能了解到整个网络的拓扑结构，并相应地更新自己的路由表。</p>
<p><strong>慢收敛：</strong>由于RIP的更新机制是周期性的，而且RIP对网络变化的检测和适应较慢，因此RIP的收敛速度相对较慢。这意味着在网络发生变化时，RIP可能需要一段时间才能适应新的路由变化。</p>
<h3 id="RIP工作原理："><a href="#RIP工作原理：" class="headerlink" title="RIP工作原理："></a>RIP工作原理：</h3><p>• 初始化：在启动一个路由守护程序时，它先判断启动了哪些接口，并在每个接口上发送一个请求报文，要求其他路由器发送完整路由表。在点对点链路中，该请求是发送给其他终点的。如果网络支持广播的话，这种请求是以广播形式发送的。目的 U D P端口号是5 2 0（这是其他路由器的路由守护程序端口号）。这种请求报文的命令字段为 1，但地址系列字段设置为 0，而度量字段设置为 1 6。这是一种要求另一端完整路由表的特殊请求报文。</p>
<p>• 接收到请求。如果这个请求是刚才提到的特殊请求，那么路由器就将完整的路由表发送给请求者。否则，就处理请求中的每一个表项：如果有连接到指明地址的路由，则将度量设置成我们的值，否则将度量置为 1 6（度量为1 6是一种称为“无穷大”的特殊值，它意味着没有到达目的的路由）。然后发回响应。</p>
<p>• 接收到响应。使响应生效，可能会更新路由表。可能会增加新表项，对已有的表项进行修改，或是将已有表项删除。</p>
<p>• 定期选路更新。每过3 0秒，所有或部分路由器会将其完整路由表发送给相邻路由器。发送路由表可以是广播形式的（如在以太网上），或是发送给点对点链路的其他终点的命令</p>
<p>• 触发更新。每当一条路由的度量发生变化时，就对它进行更新。不需要发送完整路由表，而只需要发送那些发生变化的表项。每条路由都有与之相关的定时器。如果运行 R I P的系统发现一条路由在 3分钟内未更新，</p>
<p>就将该路由的度量设置成无穷大（16），并标注为删除。这意味着已经在 6个3 0秒更新时间里没收到通告该路由的路由器的更新了。再过 6 0秒，将从本地路由表中删除该路由，以保证该路由的失效已被传播开。</p>
<p><img src="https://picx.zhimg.com/v2-8d3b7cf2cd86ddb01bef5d752611500b_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="内部网关协议OSPF"><a href="#内部网关协议OSPF" class="headerlink" title="内部网关协议OSPF"></a>内部网关协议OSPF</h3><p>O S P F是除R I P外的另一个内部网关协议。它克服了 R I P的所有限制。</p>
<p>与采用距离向量的 R I P协议不同的是， O S P F是一个链路状态协议。距离向量的意思是，</p>
<p>R I P发送的报文包含一个距离向量（跳数）。每个路由器都根据它所接收到邻站的这些距离向量来更新自己的路由表。</p>
<p>在一个链路状态协议中，路由器并不与其邻站交换距离信息。它采用的是每个路由器主</p>
<p>动地测试与其邻站相连链路的状态，将这些信息发送给它的其他邻站，而邻站将这些信息在</p>
<p>自治系统中传播出去。每个路由器接收这些链路状态信息，并建立起完整的路由表。</p>
<p>由于各路由器之间频繁的交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库(link-state database)，这个数据库的实质是全网的拓扑结构图，这个拓扑结构在全网就是一致的。因此，每一个路由器知道全网共有多少个路由器，以及那些路由器是相连的，其代价是多少等等。每一个路由器使用链路状态数据库中的数据，构造出自己的路由表(例如迪杰斯特拉的最短路径算法)。我们注意到，RIP协议的每一个路由器虽然知道所有网络的距离以及下一跳以及下一跳路由器，但却不知道全网的拓扑结构(只有到了下一跳路由器，才能知道再下一跳怎么走)。</p>
<p><img src="https://pic4.zhimg.com/v2-36d7c45ca42aa6c6ddb89a539794312b_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>从实际角度来看，二者的不同点是链路状态协议总是比距离向量协议收敛更快。收敛的意思是在路由发生变化后，例如在路由器关闭或链路出故障后，可以稳定下来。</p>
<p><strong>OSPF的三个要点和RIP都不一样：</strong></p>
<ol>
<li>向本自治系统中的所有路由器发送信息。这里使用的方法是洪范法(flooding)，</li>
</ol>
<p><img src="https://pic4.zhimg.com/v2-8af5f59d24aac8052f63f15e77abc0f7_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>这就是路由器通过所有输出端口向相邻的路由器发送信息。而每一个相邻的路由器又再将此信息发往其所有的相邻路由器。这样，最终整个所有的路由器都得到了这个信息的一个副本。更具体的做法后面继续讨论，我们应该注意，RIP协议是仅仅向自己相邻的几个路由器发送信息。</p>
<p>2，发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息，所谓的链路状态就是说明本路由状态都和哪些路由相邻，对于RIP协议，发送的信息是：“到所有网络的距离和下一跳路由器”。</p>
<p>3，只有当链路状态发生变化时候，路由器才能向所有路由器采用洪范法发送此信息。而不像RIP那样，不管网络拓扑结构是否发生变化，路由器之间都要定期更换路路由表信息。</p>
<h3 id="外部网关协议BGP"><a href="#外部网关协议BGP" class="headerlink" title="外部网关协议BGP"></a>外部网关协议BGP</h3><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>OSPF、ISIS路由协议在网络中已经广泛使用，但是随着网络规模的扩大，路由条目也随增加，IGP协议已经无法管理大规模网络了。因此出现了AS的概念。（AS是指在同一组织管理下，使用统一选路策略设备的集合。）</p>
<p>简单来说：就是你可以把一个网络中的不同的设备划分到不同的组（AS）中，或者都划分在一个组中，那么一个组中的这些设备具备相同的路由协议。</p>
<p><img src="https://pic1.zhimg.com/v2-e01220b4542d0955cc8dfe299575e2ba_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>比如你可以将企业总部网络划分在一个AS中，企业的分部网络划分在一个AS中。不同的AS可以运行不同的路由协议。</p>
<p>那么不同AS的网络需要通信时，采用什么路由协议进行通信呢？答案就是本章的BGP路由协议。那么为什么不能够通过IGP（ISIS、BGP）进行通信呢？</p>
<p>这个举个简单的例子，企业网络或者数据中心网络对接运营商的Internet时。如果使用IGP路由协议（OSPF、ISIS）对接时，那么这个时候企业网络和运营商的网络是运行在一张网络中，这个是不安全的，你可以认为运营商为什么信任你的企业网络？</p>
<p>还有一点就是整个网络规模扩大，路由数量增多，路由收敛慢。</p>
<p>那么有没有一种路由协议可以实现不同网络间的路由交互呢？答案就是BGP。BGP有个好处就是不产生路由，只传递路由，并且具备丰富的路由策略。</p>
<p><img src="https://pica.zhimg.com/v2-081d688950d282171eb0fea7c2fd1050_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="BGP传递路由优势"><a href="#BGP传递路由优势" class="headerlink" title="BGP传递路由优势"></a>BGP传递路由优势</h3><p>BGP是基于TCP的路由协议，只要能够建立TCP就能够建立BGP；</p>
<p>BGP只传递路由信息，不计算路由，不会暴露AS内部的网络拓扑；</p>
<p>BGP的路由更新是触发更新，不是周期性更新；</p>
<h3 id="什么是BGP路由协议"><a href="#什么是BGP路由协议" class="headerlink" title="什么是BGP路由协议"></a>什么是BGP路由协议</h3><p>BGP是一种基于距离矢量的路由协议，用于实现不同AS之间的路由可达。</p>
<p>BGP协议的基本特点：</p>
<p>（1）BGP是一种外部网关协议，其着眼点不在于发现和计算路由，而在于控制路由的传播和选择最佳路由；</p>
<p>（2）BGP使用TCP作为其传输层协议（端口号179）,提高了协议的可靠性；</p>
<p>（3）BGP是一种距离矢量路由协议，在设计上就避免了环路的发生；</p>
<p>（4）BGP提供了丰富的路由策略，能够实现路由的灵活过滤和选择；</p>
<p>（5）BGP采用触发式增量更新，而不是周期性的更新；</p>
<h3 id="BGP报文头格式"><a href="#BGP报文头格式" class="headerlink" title="BGP报文头格式"></a>BGP报文头格式</h3><p>不同于常见的IGP协议，BGP使用TCP作为传输层协议，端口号179。BGP存在5种不同类型的报文，不同类型的报文具有相同的头部。</p>
<p><img src="https://pic4.zhimg.com/v2-c7e39eff0fdf0e6458cb632f9a3ad1b7_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><strong>BGP选路规则与负载分担</strong></p>
<p>当到达同一目的地存在多条路由时，BGP采取如下策略进行路由选择：</p>
<p>如果此路由的下一跳不可达，忽略此路由</p>
<p>优选协议首选值（PrefVal）最高的路由 （华为设备特有属性）</p>
<p>优选本地优先级（Local_Pref）最高的路由</p>
<p>优选本地生成的路由</p>
<p>优选AS路径（AS_Path）最短的路由</p>
<p>比较Origin属性，依次优选Origin类型为IGP、EGP、Incomplete的路由</p>
<p>优选MED值最低的路由</p>
<p>优选从EBGP邻居学来的路由</p>
<p>优选到BGP下一跳IGP Metric较小的路由</p>
<h2 id="网际控制报文协议ICMP"><a href="#网际控制报文协议ICMP" class="headerlink" title="网际控制报文协议ICMP"></a>网际控制报文协议ICMP</h2><p>I C M P经常被认为是 I P层的一个组成部分。它传递差错报文以及其他需要注意的信息。</p>
<p>I C M P报文通常被I P层或更高层协议（ T C P或U D P）使用。一些 I C M P报文把差错报文返回给用户进程。</p>
<h3 id="ICMP背景与作用"><a href="#ICMP背景与作用" class="headerlink" title="ICMP背景与作用"></a>ICMP背景与作用</h3><p>ICMP协议是一个网络层协议。 一个新搭建好的网络，往往需要先进行一个简单的测试，来验证网络是否畅通；但是IP协议并不提供可靠传输。如果丢包了，IP协议并不能通知传输层是否丢包以及丢包的原因。因此我们需要ICMP协议来完成这样的功能。</p>
<p><strong>ICMP消息可以用于以下几个方面：</strong></p>
<p><strong>错误报告</strong>：当在路由过程中遇到问题或数据包丢失时，路由器或主机会向发送者发送ICMP错误消息，以便通知发送者发生了错误。例如，ICMP目的不可达消息可以告知发送者目标主机不可达。</p>
<p><strong>查询和回应</strong>：ICMP还支持查询和回应功能，用于获取关于网络设备的状态信息。例如，ICMP回应消息用于确认数据包是否成功到达目标主机，ICMP Echo请求和回应消息则用于进行网络连通性测试（常见的Ping操作）。</p>
<p><strong>重定向</strong>：当路由器接收到数据包并发现更好的路径时，可以使用ICMP重定向消息通知发送者使用新的路径来发送数据。</p>
<p><strong>时间戳</strong>：ICMP还支持时间戳请求和回应消息，用于测量网络延迟和授时。</p>
<p>ICMP消息通常被底层网络设备（如路由器）生成和处理，以帮助维护网络的正常运行和故障排除。在网络故障排查和网络监测中，ICMP起到了重要的作用，可以提供关键的信息来诊断和解决网络问题。</p>
<p>ICMP协议的功能主要有：</p>
<p>确认IP包是否成功到达目标地址</p>
<p>通知在发送过程中IP包被丢弃的原因</p>
<p><img src="https://pic2.zhimg.com/v2-2e2a022b814d598c41ed8576684a20fd_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><strong>ICMP报文</strong></p>
<p><img src="https://pic1.zhimg.com/v2-9ccfbdc7625b117d42970c2156a89fb2_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>类型：占1字节，标识ICMP报文的类型，从类型值来看ICMP报文可以分为两大类。第一类是取值为1~127的差错报文，第2类是取值128以上的信息报文</p>
<p>代码：占1字节，标识对应ICMP报文的代码。它与类型字段一起共同标识了ICMP报文的详细类型</p>
<p>校验和：占2字节，这是对包括ICMP报文数据部分在内的整个ICMP数据报的校验和，以检验报文在传输过程中是否出现了差错</p>
<p>内容：占8字节。</p>
<h3 id="ICMP报文的类型"><a href="#ICMP报文的类型" class="headerlink" title="ICMP报文的类型"></a>ICMP报文的类型</h3><p>常见的ICMP报文可以分为两大类，即差错报文和查询报文。</p>
<p>当发送一份I C M P差错报文时，报文始终包含 I P的首部和产生I C M P差错报文的I P数据报的前8个字节。这样，接收 I C M P差错报文的模块就会把它与某个特定的协议（根据 I P数据报首部中的协议字段来判断）和用户进程（根据包含在 I P数据报前8字节中的T C P或U D P报文首部中的T C P或U D P端口号来判断）联系起来。</p>
<p><img src="https://pica.zhimg.com/v2-668cb57e318656d7c90cefcef8f8e726_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>下面各种情况都不会导致产生 I C M P差错报文：</p>
<ol>
<li>ICMP差错报文（但是，I C M P查询报文可能会产生I C M P差错报文）。</li>
<li>目的地址是广播地址（见图 3 - 9）或多播地址（D类地址，见图1 - 5）的I P数据报。</li>
<li>作为链路层广播的数据报。</li>
<li>不是I P分片的第一片（将在11 . 5节介绍分片）。</li>
<li>源地址不是单个主机的数据报。这就是说，源地址不能为零地址、环回地址、广播地</li>
</ol>
<p>址或多播地址。</p>
<p>这些规则是为了防止过去允许 I C M P差错报文对广播分组响应所带来的广播风暴。</p>
<h2 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h2><p>IPv6是用于网络通信的下一代IP协议。它是IPv4的继任者，旨在解决IPv4所面临的地址空间枯竭和其他一些限制性问题。</p>
<h3 id="基本首部"><a href="#基本首部" class="headerlink" title="基本首部"></a>基本首部</h3><p><img src="https://pic2.zhimg.com/v2-887eb41091f3ca32b729c846fca87727_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="改进和特性"><a href="#改进和特性" class="headerlink" title="改进和特性"></a>改进和特性</h3><p><strong>更大的地址空间：</strong>IPv6采用128位的地址空间，相比IPv4的32位地址空间大得多，提供了约340亿亿亿亿（3.4×10^38）个可用的IP地址。这样大的地址空间可以满足未来互联网设备的需求，并解决了IPv4中出现的地址耗尽问题。</p>
<p><strong>简化的地址表示</strong>：IPv6地址使用8组四位十六进制数表示，以冒号分隔，例如2001:0db8:85a3:0000:0000:8a2e:0370:7334。为了进一步简化表示，连续的0可以省略并用“::”表示一次，例如2001:0db8:85a3::8a2e:0370:7334。这种简化的表示形式使IPv6地址更易读和管理。</p>
<p><strong>改进的扩展性和灵活性</strong>：IPv6引入了扩展头（Extension Headers）的概念，可以在IPv6数据包中添加各种扩展选项，如认证和加密扩展。这种灵活性使得IPv6在支持新的网络功能和服务方面更具有优势。</p>
<p><strong>改进的安全性：</strong>IPv6在协议层面提供了更强的安全性支持，包括IPsec（IP Security）的原生支持。IPsec可以提供数据的加密、身份验证和完整性保护，为网络通信提供更高的安全性。</p>
<p>改进的多播支持：IPv6对多播（Multicast）进行了改进，引入了一种新的多播地址类型，称为组播地址，用于在IPv6网络中进行有效的多播通信。</p>
<p><strong>简化的网络配置：</strong>IPv6通过自动配置的方式，使得网络设备可以自动获取全局唯一的IPv6地址，而无需手动配置或使用DHCP（Dynamic Host Configuration Protocol）。这种简化的网络配置过程降低了网络管理的复杂性。</p>
<h2 id="网络组管理协议IGMP"><a href="#网络组管理协议IGMP" class="headerlink" title="网络组管理协议IGMP"></a>网络组管理协议IGMP</h2><p>IGMP是一种用于在IP网络中进行组播管理的协议。</p>
<p>组播是一种将数据包从一个源发送到多个目的地的通信方式，可以有效地实现多播流量的分发。IGMP协议用于主机和路由器之间的交互，以便主机能够加入、离开和查询组播组，并确保只有对组播感兴趣的主机接收到相关数据。</p>
<h3 id="IGMP报文"><a href="#IGMP报文" class="headerlink" title="IGMP报文"></a>IGMP报文</h3><p><img src="https://pic1.zhimg.com/v2-f9d96b14ed3e22f32b9363314f66f774_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="IGMP协议"><a href="#IGMP协议" class="headerlink" title="IGMP协议"></a>IGMP协议</h3><p>多播的基础就是一个进程的概念（使用的术语进程是指操作系统执行的一个程序），该进</p>
<p>程在一个主机的给定接口上加入了一个多播组。在一个给定接口上的多播组中的成员是动态的—它随时因进程加入和离开多播组而变化。</p>
<p>这里所指的进程必须以某种方式在给定的接口上加入某个多播组。进程也能离开先前加</p>
<p>入的多播组。这些是一个支持多播主机中任何 A P I所必需的部分。使用限定词“接口”是因为多播组中的成员是与接口相关联的。一个进程可以在多个接口上加入同一多播组。</p>
<p><strong>多播路由器使用I G M P报文来记录与该路由器相连网络中组成员的变化情况。使用规则如</strong></p>
<p><strong>下：</strong></p>
<ol>
<li>当第一个进程加入一个组时，主机就发送一个 I G M P报告。如果一个主机的多个进程加入同一组，只发送一个I G M P报告。这个报告被发送到进程加入组所在的同一接口上。</li>
<li>进程离开一个组时，主机不发送 I G M P报告，即便是组中的最后一个进程离开。主机知道在确定的组中已不再有组成员后，在随后收到的 I G M P查询中就不再发送报告报文。</li>
<li>多播路由器定时发送I G M P查询来了解是否还有任何主机包含有属于多播组的进程。多播路由器必须向每个接口发送一个 I G M P查询。因为路由器希望主机对它加入的每个多播组均<br>发回一个报告，因此I G M P查询报文中的组地址被设置为 0。</li>
<li>主机通过发送I G M P报告来响应一个I G M P查询，对每个至少还包含一个进程的组均要发回I G M P报告。</li>
</ol>
<p><strong>使用这些查询和报告报文，多播路由器对每个接口保持一个表，表中记录接口上至少还</strong></p>
<p><strong>包含一个主机的多播组。当路由器收到要转发的多播数据报时，它只将该数据报转发到（使</strong></p>
<p><strong>用相应的多播链路层地址）还拥有属于那个组主机的接口上。</strong></p>
<p><img src="https://pic3.zhimg.com/v2-da1fb8f9b33337f01f143cb488eddd32_1440w.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>多播是一种将报文发往多个接收者的通信方式。在许多应用中，它比广播更好，因为多播降低了不参与通信的主机的负担。简单的主机成员报告协议 ( I G M P )是多播的基本模块。在一个局域网中或跨越邻近局域网的多播需要使用这里介绍的技术。广播通常局限在单个局域网中，对目前许多使用广播的应用来说，可采用多播来替代广播。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="category-chain-item">基础知识</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="category-chain-item">计算机网络</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="print-no-link">#计算机网络</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>网络层</div>
      <div>http://example.com/2023/01/30/网络层/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ling</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年1月30日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/02/05/AES%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86%E4%B8%8E%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0/" title="AES算法原理与逆向练习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">AES算法原理与逆向练习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/01/25/%E5%A4%96%E5%AD%98%E7%AE%A1%E7%90%86%E3%80%90%E8%A1%A5%E5%85%85%E3%80%91/" title="外存管理【补充】">
                        <span class="hidden-mobile">外存管理【补充】</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
